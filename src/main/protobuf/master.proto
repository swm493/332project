syntax = "proto3";
package sorting;

import "common.proto";

message RegisterRequest {
  string workerId = 1;
}

message RegisterReply {
  int32 assignedState = 1;
  repeated ProtoKey splitters = 2;
  repeated string allWorkerIds = 3;
}

message SampleRequest {
  string workerId = 1;
  repeated ProtoKey samples = 2;
}

message SampleReply {
  bool ack = 1;
}

message NotifyRequest {
  string workerId = 1;
  string message = 2;
}

message NotifyReply {
  bool ack = 1;
}

message HeartbeatRequest {
  string worker_id = 1;
}

message HeartbeatReply {
  enum WorkerState {
    Unregistered = 0;
    Sampling = 1;
    Shuffling = 2;
    Merging = 3;
    Done = 4;
    Failed = 5;
    Waiting = 6;
  }
  WorkerState state = 1;
}

message GetGlobalStateRequest {
  string workerId = 1;
}

message GetGlobalStateReply {
  repeated ProtoKey splitters = 1;
  repeated string allWorkerIds = 2;
}

service MasterService {
  rpc RegisterWorker (RegisterRequest) returns (RegisterReply);
  rpc SubmitSamples (SampleRequest) returns (SampleReply);

  rpc Heartbeat (HeartbeatRequest) returns (HeartbeatReply);
  rpc GetGlobalState (GetGlobalStateRequest) returns (GetGlobalStateReply);

  rpc NotifyShuffleComplete (NotifyRequest) returns (NotifyReply);
  rpc NotifyMergeComplete (NotifyRequest) returns (NotifyReply);
}